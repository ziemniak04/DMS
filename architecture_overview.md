# Diabetes Management System (DMS) — Architecture Overview

## 1. Technology Stack
- **Flutter** — cross‑platform UI (Android, iOS, Web)
- **Python (FastAPI)** — backend, analytics, digital twin, agents
- **Firebase Auth** — user authentication (patients & doctors)
- **Firestore / Supabase** — encrypted storage for medical data
- **Dexcom G6/G7 API** — continuous glucose monitoring
- **Cloud Storage** — PDF reports & doctor documents

---

## 2. High‑Level Architecture
```
Flutter App
   ↓ Firebase Auth
Python Backend (FastAPI)
   ↓ Dexcom API
Encrypted Database (Firestore/Supabase)
   ↓
Agent System (Prediction, Patterns, Reports)
```

---

## 3. System Components

### A. Flutter Frontend
- Handles UI for patients and doctors
- Uses Firebase Auth for login
- Displays glucose charts, meals, activity, alerts
- Secure client‑side storage via Keychain/Keystore
- Communicates with backend via HTTPS + Firebase ID token

### B. Python FastAPI Backend
- Validates Firebase ID tokens
- Pulls real‑time and historical data from Dexcom
- Executes all analytics + agent logic
- Provides REST endpoints for Flutter app
- Generates weekly reports and PDFs
- Stores encrypted medical data in Firestore/Supabase

### C. Firebase Authentication
- Manages user accounts
- Assigns roles (patient/doctor) via custom claims
- Issues ID tokens for backend authorization

### D. Database Layer
- Firestore or Supabase
- Stores:
  - glucose history (encrypted)
  - meal logs
  - activity logs
  - digital twin parameters
  - doctor notes
  - agent summaries

### E. Cloud Storage
- Weekly PDF reports generated by backend
- Shared securely with doctors and patients

---

## 4. Dexcom Integration
- Python backend stores Dexcom refresh token (encrypted)
- Backend syncs glucose every ~5 minutes
- Fetches 1/7/14/30‑day history
- Correlates glucose with:
  - meals
  - activity
  - trends
  - predictions

---

## 5. Agent System

### Agent 1 — Pattern Detection
- Runs hourly
- Detects recurrent highs/lows
- Identifies behavioral patterns

### Agent 2 — Prediction Agent
- Runs on each new glucose datapoint
- Predicts 30–60 minutes ahead
- Warns about possible hypo/hyper events

### Agent 3 — Summary & Reporting Agent
- Runs daily
- Produces weekly summaries + PDF reports
- Highlights risks for doctors

---

## 6. Digital Twin Model
A simplified patient model built from:
- insulin sensitivity
- carb response
- glucose decay rate
- time‑to‑hypo estimation

Used for:
- simulating food intake
- predicting glucose impact
- personalized nutrition feedback

---

## 7. Security Architecture
- Firebase Auth secures login
- Backend verifies Firebase ID tokens
- All medical data encrypted **client‑side** before upload
- Keys stored in Keystore / Keychain
- Backend never sees raw PHI
- HTTPS everywhere
- Audit logs for doctor access

---

## 8. Data Flow Summary
1. User logs in via Firebase
2. Flutter receives ID token
3. Flutter sends token to FastAPI
4. FastAPI validates token
5. FastAPI fetches Dexcom data
6. Agents analyze data
7. Results stored encrypted in database
8. Flutter fetches insights + reports

---

## 9. Resulting System
A clean, lightweight and scalable Diabetes Management System featuring:
- Flutter UI for patient & doctor roles
- Python backend for analytics + Dexcom integration
- Firebase Auth for secure login
- Encrypted cloud storage for medical data
- Predictive agents & digital twin model
- Automated reporting and patient insights

